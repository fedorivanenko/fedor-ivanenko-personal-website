{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "wheel-picker",
  "type": "registry:component",
  "title": "Wheel Picker",
  "description": "wheel picker",
  "files": [
    {
      "path": "../../packages/wheel-picker/src/wheel-picker.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { useDrag, useWheel } from \"@use-gesture/react\";\nimport { animated, useReducedMotion, useSprings } from \"@react-spring/web\";\nimport { cn } from \"./utils\";\n\ntype CSSSize = `${number}${\"px\" | \"rem\" | \"em\"}`;\n\n// Exposed imperative API methods for external control\nexport interface WheelPickerHandle {\n  // Rotates wheel to a specific option\n  rotateTo: (option: WheelPickerOption) => void;\n  // Resets wheel position to the first option\n  reset: () => void;\n}\n\n// Shape of each selectable option in the picker\nexport interface WheelPickerOption {\n  // Option value used for selection and form integration\n  value: string;\n  // Display label rendered inside the wheel\n  label: React.ReactNode;\n}\n\n// Props for the WheelPicker component\nexport interface WheelPickerProps {\n  //\n  id: string;\n\n  // Ref exposing the WheelPickerHandle API\n  forwardedRef?: React.Ref<WheelPickerHandle>;\n\n  // React Hook Form internal callback for focus management\n  // biome-ignore lint/suspicious/noExplicitAny: external API needs an escape hatch\n  callbackRef?: (instance: any) => void;\n\n  // List of selectable options displayed in the wheel\n  options: WheelPickerOption[];\n\n  // Callback fired when user selects an option\n  onPick: (value: string) => void;\n\n  // Handlers for focus and blur events (a11y and form integration)\n  onFocus?: React.FocusEventHandler<HTMLDivElement>;\n  onBlur?: React.FocusEventHandler<HTMLDivElement>;\n\n  // Marks the picker as required for aria-required\n  required?: boolean;\n\n  // Disables user input and animations\n  disabled?: boolean;\n\n  // Height of the highlighter (e.g., \"1.2em\", \"32px\")\n  height?: CSSSize;\n\n  // Angular distance between visible options in degrees (controls curvature)\n  angleStep?: number;\n\n  // Threshold (in px) to trigger selection movement for wheel and drag\n  tresHold?: {\n    wheel: number;\n    drag: number;\n  };\n\n  // Enables infinite looping (default true if > 6 options)\n  loop?: boolean;\n\n  // Optional custom class for the root container\n  containerClassName?: string;\n\n  // Optional custom class applied to each option\n  optionClassName?: string;\n\n  // Optional custom class for the highlighter element\n  highliterClassName?: string;\n}\n\nconst shift = (prev: number[], loop: boolean, dir: number) => {\n  const next = [...prev];\n\n  if (loop) {\n    if (dir === 1) {\n      const first = next.shift()!;\n      next.push(first);\n    } else {\n      const last = next.pop()!;\n      next.unshift(last);\n    }\n    return next;\n  }\n\n  if (dir === 1) {\n    const first = next[0];\n    if (first >= 0) return next;\n    return next.map((n) => n + 1);\n  } else {\n    const last = next[next.length - 1];\n    if (last <= 0) return next;\n    return next.map((n) => n - 1);\n  }\n};\n\nconst createPositions = (length: number, centered: boolean): number[] => {\n  if (centered) {\n    const mid = Math.floor(length / 2);\n    return Array.from({ length }, (_, i) => (i <= mid ? i : i - length));\n  }\n  return Array.from({ length }, (_, i) => i);\n};\n\n//Core\nfunction WheelPicker({\n  id,\n  forwardedRef,\n  callbackRef,\n  onPick,\n  onFocus,\n  onBlur,\n  required,\n  disabled,\n  options,\n  loop = options.length >= 6,\n  tresHold = {\n    wheel: 32, //px\n    drag: 24, //px\n  },\n  angleStep = 12, //deg\n  height = \"2em\",\n  containerClassName,\n  optionClassName,\n  highliterClassName,\n}: WheelPickerProps) {\n  // minimum interval (ms) between wheel updates to prevent animation jamming\n  const throttle = 72;\n\n  const [wheelState, setWheelState] = React.useState(() => ({\n    pos: createPositions(options.length, loop),\n    vel: 0,\n  }));\n\n  const wheelPickerRef = React.useRef<HTMLDivElement>(null);\n  //combine inner ref with RHF callback ref\n  const setRefs = React.useCallback(\n    (element: HTMLDivElement | null) => {\n      wheelPickerRef.current = element;\n      if (callbackRef) callbackRef(element);\n    },\n    [callbackRef]\n  );\n\n  const reducedMotion = useReducedMotion();\n\n  const [springs] = useSprings(\n    options.length,\n    (i) => {\n      const { vel: velocity, pos: positions } = wheelState;\n      const vel = Math.abs(velocity);\n      const pos = positions[i];\n      const dist = Math.abs(pos);\n      const immediate = dist > 4 || !!reducedMotion;\n\n      return {\n        scale: pos ? 0.9 : 1,\n        rotateX: pos * angleStep,\n        opacity: [1, 0.75, 0.5, 0.25][dist] ?? 0,\n        immediate: immediate,\n        config: {\n          tension: Math.min(500, 250 + vel * 250),\n          friction: Math.min(100, 20 + vel * 10),\n        },\n      };\n    },\n    [wheelState]\n  );\n\n  const lastUpdate = React.useRef<number>(0);\n  const eY = React.useRef<number>(0);\n  const prevDir = React.useRef<number>(0);\n\n  // throttle animation updates\n  const wheelStateUpdate = React.useCallback(\n    ({ dir, vel }: { dir: number; vel: number }) => {\n      const now = Date.now();\n      if (now - lastUpdate.current >= throttle) {\n        setWheelState((prev) => ({\n          pos: shift([...prev.pos], loop, dir),\n          vel,\n        }));\n        lastUpdate.current = now;\n        eY.current = 0;\n      }\n    },\n    [loop, throttle, setWheelState]\n  );\n\n  // update parent form\n  const first = React.useRef(true);\n  const timer = React.useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  React.useEffect(() => {\n    if (first.current) {\n      first.current = false;\n      return;\n    }\n\n    if (timer.current) clearTimeout(timer.current);\n\n    // debounce to not overload parent form\n    timer.current = setTimeout(() => {\n      const selected = options[wheelState.pos.indexOf(0)].value;\n      onPick(selected);\n      timer.current = null;\n    }, 125);\n\n    return () => {\n      if (timer.current) clearTimeout(timer.current);\n    };\n    // biome-ignore lint/react-hooks/exhaustiveDeps: dependencies intentionally limited to throttle parent form updates\n  }, [onPick, wheelState.pos]);\n\n  // imperiative rotation\n  const animateSteps = React.useCallback(\n    async (dist: number) => {\n      const steps = Math.abs(dist);\n      const dir = -Math.sign(dist);\n\n      for (let i = 0; i < steps; i++) {\n        wheelStateUpdate({ dir, vel: 0 });\n        await new Promise((res) => setTimeout(res, throttle + 5));\n      }\n    },\n    [wheelStateUpdate, throttle]\n  );\n\n  const rotateTo = React.useCallback(\n    (to: WheelPickerOption) => {\n      const pos = options.findIndex((opt) => opt.value === to.value);\n      if (pos >= 0) {\n        animateSteps(wheelState.pos[pos]);\n      }\n    },\n    [options, wheelState.pos, animateSteps]\n  );\n\n  // expose imperiative methods\n  React.useImperativeHandle(\n    forwardedRef,\n    () => ({\n      rotateTo,\n      reset() {\n        animateSteps(wheelState.pos[0]);\n      },\n    }),\n    [wheelState.pos, animateSteps, rotateTo]\n  );\n\n  // gestures\n  useWheel(\n    ({ velocity: [, vY], direction: [, dirY], delta: [, dY], event }) => {\n      if (disabled) return;\n\n      event.preventDefault();\n      handleMove(dirY, vY, Math.abs(dY), \"wheel\");\n    },\n    {\n      target: wheelPickerRef,\n      eventOptions: { passive: false },\n    }\n  );\n\n  useDrag(\n    ({\n      direction: [, dirY],\n      velocity: [, vY],\n      delta: [, dY],\n      first,\n      last,\n      event,\n    }) => {\n      if (disabled) return;\n      event.preventDefault();\n      if (first) eY.current = 0;\n\n      handleMove(-dirY, vY, dY, \"drag\");\n\n      // inertia\n      if (last && vY > 0.1) {\n        const steps = Math.min(Math.round(vY * 8), 12);\n\n        for (let i = 0; i < steps; i++) {\n          const decay = Math.exp(-i / 6);\n          const vel = vY * 4 * decay;\n          const delay = throttle + i * i * 6;\n\n          setTimeout(() => {\n            wheelStateUpdate({ dir: -dirY, vel });\n          }, delay);\n        }\n      }\n    },\n    {\n      target: wheelPickerRef,\n      axis: \"y\",\n      filterTaps: true,\n      rubberband: 0,\n      eventOptions: { passive: false },\n      pointer: { touch: true },\n    }\n  );\n\n  function handleMove(\n    dirY: number,\n    vY: number,\n    dY: number,\n    action: \"wheel\" | \"drag\"\n  ) {\n    eY.current += Math.abs(dY);\n\n    if (dirY !== prevDir.current && dirY !== 0) {\n      prevDir.current = dirY;\n      eY.current = 0;\n      return;\n    }\n    const tresh =\n      action === \"wheel\"\n        ? tresHold.wheel\n        : action === \"drag\"\n        ? tresHold.drag\n        : 32;\n\n    if (eY.current > tresh) {\n      wheelStateUpdate({ dir: dirY, vel: vY });\n    }\n  }\n\n  // events\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (disabled) return;\n    switch (e.key) {\n      case \"ArrowDown\":\n        e.preventDefault();\n        wheelStateUpdate({\n          dir: -1,\n          vel: 0,\n        });\n        break;\n      case \"ArrowUp\":\n        e.preventDefault();\n        wheelStateUpdate({\n          dir: 1,\n          vel: 0,\n        });\n        break;\n      case \"Escape\":\n        e.preventDefault();\n        wheelPickerRef.current?.blur();\n      case \"Enter\":\n        e.preventDefault();\n        // Move focus to next focusable element\n        const current = e.currentTarget as HTMLElement;\n        const form = current.closest(\"form\");\n        if (form) {\n          const elements = Array.from(\n            form.querySelectorAll<HTMLElement>(\n              \"button, [href], input, select, textarea, [tabindex]:not([tabindex='-1'])\"\n            )\n          );\n          const index = elements.indexOf(current);\n          const next = elements[index + 1];\n          next?.focus();\n        }\n        break;\n    }\n  };\n\n  const handleClick = () => {\n    if (disabled) return;\n    wheelPickerRef.current?.focus();\n  };\n\n  const handleWheel = () => {\n    if (disabled) return;\n    wheelPickerRef.current?.focus();\n  };\n\n  const selectedIndex = wheelState.pos.indexOf(0);\n  const selectedValue = options[selectedIndex]?.value;\n\n  return (\n    <>\n      <span id={`${id}-hint`} className=\"sr-only\">\n        Use ↑/↓ to navigate. Enter to select an move to next field. Esc to\n        clear.\n      </span>\n      <div\n        id={id}\n        ref={setRefs}\n        tabIndex={0}\n        onFocus={onFocus}\n        onBlur={onBlur}\n        onClick={() => handleClick()}\n        onWheel={() => handleWheel()}\n        onKeyDown={(e) => handleKeyDown(e)}\n        aria-required={required ? true : undefined}\n        aria-disabled={disabled ? true : undefined}\n        aria-labelledby={`${id}-label`}\n        aria-describedby={`${id}-hint`}\n        role=\"listbox\"\n        className={cn(\n          \"select-none touch-none text-[inherit] aria-[disabled]:opacity-75 aria-[disabled]:bg-foreground/5 cursor-grab  relative flex-1 overflow-hidden outline-none focus:ring-1 focus:ring-accent before:content-[''] before:absolute before:-inset-4\",\n          containerClassName\n        )}\n        style={{\n          perspective: \"64rem\",\n          [\"--rad\" as string]: (angleStep * 3.14159) / 180,\n          [\"--wheel-picker-height\" as string]: height,\n        }}\n        /*\n          shadcn-ui variables naming convention is used \n          https://ui.shadcn.com/docs/theming#list-of-variables\n        */\n      >\n        <div\n          className={cn(\n            \"absolute -translate-y-1/2 inset-x-2 top-1/2  bg-foreground/5 h-[var(--wheel-picker-height)]\",\n            highliterClassName\n          )}\n        />\n        {options.map((option, index) => (\n          <animated.div\n            id={`${id}-opt-${index}`}\n            key={option.value}\n            role=\"option\"\n            aria-selected={option.value === selectedValue}\n            style={{\n              scale: springs[index].scale,\n              rotateX: springs[index].rotateX,\n              opacity: springs[index].opacity,\n              transformOrigin:\n                \"center center calc(-1 * calc(var(--wheel-picker-height) / var(--rad)))\",\n              backfaceVisibility: \"hidden\",\n            }}\n            className={cn(\n              \"absolute -translate-y-1/2 flex flex-col items-center justify-center top-1/2 w-full h-[var(--wheel-picker-height)]\",\n              optionClassName\n            )}\n            onClick={() => rotateTo(option)}\n          >\n            {option.label}\n          </animated.div>\n        ))}\n      </div>\n    </>\n  );\n}\n\ninterface WheelPickerWrapperProps extends React.HTMLAttributes<HTMLDivElement> {\n  invalid: boolean;\n}\n\nconst wheelPickerWrapperStyle =\n  \"border border-border flex data-[invalid]:ring-destructive shadow-destructive ring-1 ring-offset-1 ring-offset-background ring-transparent transition-all duration-250\";\n/*\n  shadcn-ui variables naming convention is used \n  https://ui.shadcn.com/docs/theming#list-of-variables\n*/\nfunction WheelPickerWrapper(props: WheelPickerWrapperProps) {\n  return (\n    <div\n      {...(props.invalid ? { \"data-invalid\": \"\" } : null)}\n      className={cn(wheelPickerWrapperStyle, props.className)}\n    >\n      {props.children}\n    </div>\n  );\n}\n\nexport { WheelPicker, WheelPickerWrapper, wheelPickerWrapperStyle };\n",
      "type": "registry:component"
    }
  ]
}